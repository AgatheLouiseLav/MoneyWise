{% extends 'base.html' %}
{% block content %}

<h1>Stocks</h1>
<br>
<form id="stock-form" action="">
    <label for="stock-search">Select a Stock</label>
    <select id="stock-search">
    {% for stock in stock_selection %}
        <option value="{{ stock.1 }}-{{ stock.0 }}">{{ stock.0 }}</option>
    {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary">Find</button>
</form>
<br><br>
<p>Warning the api only lets you do 100 calls per day, so might be buggy in development if I've been spamming it.</p>
<div id="stock-section">
    <h2></h2>
</div>
<!-- display graph/chart to show the stock price changes -->

<script>
    const baseURL = 'https://www.alphavantage.co/query';
    const apiKey = 'KEDWTVV13Y63RVQR';


    let outputType = 'TIME_SERIES_MONTHLY';


    document.getElementById('stock-form').addEventListener('submit', function(event) {
        event.preventDefault();
        let [stock, name] = document.getElementById('stock-search').value.split('-');




        const url = `${baseURL}?function=${outputType}&symbol=${stock}&apikey=${apiKey}`;
        fetch(url)
        .then(response => response.json())
        .then(data => {
            console.log(data)
            const timeSeriesData = data['Monthly Time Series'];
            const latestDataPoint = Object.values(timeSeriesData)[0];
            const currentStockPrice = parseFloat(latestDataPoint['4. close']);

            document.querySelector('h2').innerText = `${name}: Â£${currentStockPrice.toFixed(2)}`;

        })
        .catch(error => {
            console.error('Error fetching data:', error);
        })

    })


</script>

{% endblock %}